{% for station in results %}
<div>
    <p><b>{{ station.Name }}</b> - {{ station.Address }}</p>
    <button onclick="selectStation({{ station.id }})">Select</button>  <!-- Pass station.id -->
</div>
{% endfor %}

<script>


    
 function selectStation(stationId) {
    console.log("Selected Station ID:", stationId);  // Debug log

    fetch(`/station_info/${stationId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Station not found');
            }
            return response.json();
        })
        .then(data => {
            console.log("Station Data:", data);  // Debug log

            // Check if elements exist
            const stationNameElement = document.getElementById('station-name');
            const stationCompanyElement = document.getElementById('station-company');
            const stationRatingElement = document.getElementById('station-rating');
            const stationIdElement = document.getElementById('station-id');

            if (!stationNameElement || !stationCompanyElement || !stationRatingElement || !stationIdElement) {
                throw new Error('One or more elements not found in the DOM');
            }

            // Update the elements
            stationCompanyElement.innerText = "Charging Station Company: " + data.Name;
            stationNameElement.innerText = "Station Address: " + data.Address;  // Fix: Use data.Address
            stationRatingElement.innerText = 'Rating: ' + (data.Rating || 'N/A');
            stationIdElement.value = data.id;

           fetch(`/ratingAndReview/${stationId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch reviews');
                    }
                    return response.json();
                })
                .then(reviews => {
                    console.log("Reviews:", reviews);  // Debug log

                    // Check if the reviews element exists
                    const reviewsElement = document.getElementById('station-reviews');

                    if (!reviewsElement) {
                        throw new Error('Reviews element not found in the DOM');
                    }

                    // Clear the reviews element
                    reviewsElement.innerHTML = '';

                    // Add each review to the reviews element
                    reviews.forEach(review => {
                        const reviewElement = document.createElement('div');
                        reviewElement.innerHTML = `
                            <p><b>${review[0]}</b> - ${review[1]} stars</p>
                            <p>Comment: ${review[2]}</p>
                        `;
                        reviewsElement.appendChild(reviewElement);
                    });
                })
                .catch(error => {
                    console.error('Error fetching reviews:', error);
                });

            // Clear the search results dropdown
            document.getElementById('search-results').innerHTML = '';
            document.getElementById('selected-station-info').scrollIntoView({ behavior: 'smooth' });
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to fetch station information.');
        });
}
</script>